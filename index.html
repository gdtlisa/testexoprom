<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercice Interactif Prompting - Atprom Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy: #0a194e; --yellow: #fcd45c; --teal: #227c7d; 
            --pink: #e91e9e; --green: #a6e27e; --red: #ff4d4d;
            --light-teal: #8ec5c6; --light-pink: #f4a7d6; --light-yellow: #fef08a;
            --gray-bubble: #e5e7eb;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f7f6;
            margin: 0; padding: 0;
            display: flex; justify-content: center; min-height: 100vh;
        }

        #login-screen {
            position: fixed; inset: 0; background: var(--navy);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 1000; color: white;
        }
        #login-screen input {
            padding: 12px; border-radius: 8px; border: none; margin: 20px 0; width: 250px;
            font-size: 1rem; text-align: center;
        }

        .container {
            max-width: 1100px; width: 95%; background: white;
            margin: 20px; padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none; position: relative;
        }

        h2 { color: var(--navy); border-left: 5px solid var(--teal); padding-left: 15px; }

        /* Frise */
        .frise {
            display: flex; margin-bottom: 40px; border-radius: 10px; overflow: hidden;
            height: 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .frise-step {
            flex: 1; display: flex; align-items: center; justify-content: center;
            font-size: 0.75rem; font-weight: bold; color: white; opacity: 0.3;
            transition: 0.3s; text-transform: uppercase;
        }
        .frise-step.active { opacity: 1; }

        /* Grilles */
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; }
        .card {
            background: #fff; border: 2px solid #eee; padding: 25px;
            border-radius: 15px; cursor: pointer; transition: 0.3s; text-align: center;
            font-weight: 600; color: var(--navy);
        }
        .card:hover { transform: translateY(-5px); border-color: var(--teal); }
        .card.selected { background: var(--teal) !important; color: white !important; border-color: var(--navy); }

        /* Blocs */
        .prompt-blocks { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin-top: 20px; }
        .block-wrapper { display: flex; flex-direction: column; align-items: center; width: 200px; }
        .block-box {
            width: 100%; height: 100px; border-radius: 10px; padding: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.85rem; text-align: center; box-sizing: border-box; border: 2px solid transparent;
        }
        .block-box textarea {
            width: 100%; height: 100%; border: none; background: transparent;
            resize: none; font-family: inherit; font-size: 0.8rem; text-align: center;
        }

        /* Quiz Bulles */
        .bubble {
            background: var(--gray-bubble); padding: 20px; border-radius: 20px 20px 20px 5px;
            position: relative; margin-bottom: 10px; transition: 0.4s;
        }
        .bubble.correct-glow { border: 3px solid var(--green); background: #f0fdf4; }
        .bubble.wrong-glow { border: 3px solid var(--red); background: #fef2f2; }
        
        .btn-check-group { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;}
        .btn-verify { padding: 8px 15px; border-radius: 20px; border: 1px solid #ccc; cursor: pointer; font-size: 0.8rem; background: white; transition: 0.2s;}
        .btn-verify.active-correct { background: var(--green); color: white; border-color: var(--green); }
        .btn-verify.active-incorrect { background: var(--red); color: white; border-color: var(--red); }

        /* Checkboxes Etape 8 */
        .checkbox-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .check-item { 
            display: flex; align-items: center; gap: 8px; font-size: 0.85rem; 
            padding: 8px; background: white; border-radius: 5px; border: 1px solid #ddd;
        }
        .check-item.correct-match { background: #dcfce7; border-color: var(--green); color: #166534; }
        .check-item.wrong-match { background: #fee2e2; border-color: var(--red); color: #991b1b; }

        .nav-btns { display: flex; justify-content: space-between; margin-top: 40px; }
        button.primary {
            background: var(--navy); color: white; border: none; padding: 12px 30px;
            border-radius: 30px; cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        button.primary:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        button.primary:hover:not(:disabled) { background: var(--teal); transform: scale(1.05); }
        
        .result-box { margin-top: 15px; font-weight: bold; padding: 10px; border-radius: 8px; text-align: center; display: none; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="login-screen">
    <h1>Accès Sécurisé</h1>
    <input type="password" id="pass" placeholder="Mot de passe : Atprom.2026.2">
    <button class="primary" onclick="checkPass()">Se connecter</button>
</div>

<div class="container" id="main">
    <div class="frise" id="frise-container"></div>

    <section id="step1">
        <h2>1. Choisissez un problème</h2>
        <div class="grid-3">
            <div class="card p-card" onclick="selectProblem(1, this)">Problème 1</div>
            <div class="card p-card" onclick="selectProblem(2, this)">Problème 2</div>
            <div class="card p-card" onclick="selectProblem(3, this)">Problème 3</div>
        </div>
    </section>

    <section id="step2" class="hidden">
        <h2>2. Choisissez une technique</h2>
        <div class="grid-3" id="technique-options"></div>
    </section>

    <section id="step3" class="hidden">
        <h2>3. Rédigez votre message</h2>
        <div class="prompt-blocks" id="input-blocks"></div>
        <p style="text-align:center; color: #666; margin-top: 20px;">(Remplissez tous les blocs pour continuer)</p>
    </section>

    <section id="step4" class="hidden">
        <h2>4. Analyse de la correction</h2>
        <div class="prompt-blocks" id="correction-blocks"></div>
    </section>

    <section id="step5" class="hidden">
        <h2>5. Définition théorique</h2>
        <div style="background: #f0fdfa; padding: 30px; border-radius: 15px; border-left: 10px solid var(--teal);">
            <p style="font-size: 1.1rem; line-height: 1.6;"><strong>Problème :</strong> point sur lequel on s'interroge, question qui prête à discussion, qui fait l'objet d'argumentations, de théories diverses, en particulier dans le domaine de la connaissance.</p>
        </div>
    </section>

    <section id="step6" class="hidden">
        <h2>6. Évaluation des messages</h2>
        <div class="grid-3" id="chat-quiz" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));"></div>
        <button class="primary" style="margin: 20px auto; display: block;" onclick="validateStep6()">Vérifier les messages</button>
        <div id="score6" class="result-box"></div>
    </section>

    <section id="step7" class="hidden">
        <h2>7. Classification</h2>
        <div class="grid-3">
            <div class="card" style="border-top: 8px solid var(--green);"><h3>Simple</h3><p>Techniques 1, 2, 3</p></div>
            <div class="card" style="border-top: 8px solid var(--yellow);"><h3>Intermédiaire</h3><p>Techniques 4, 5, 6</p></div>
            <div class="card" style="border-top: 8px solid var(--pink);"><h3>Complexe</h3><p>Techniques 7, 8, 9</p></div>
        </div>
    </section>

    <section id="step8" class="hidden">
        <h2>8. Matching Final</h2>
        <div id="final-match"></div>
        <button class="primary" style="margin: 20px auto; display: block;" onclick="validateStep8()">Vérifier le matching</button>
        <div id="score8" class="result-box"></div>
    </section>

    <div class="nav-btns">
        <button class="primary" id="prevBtn" onclick="changeStep(-1)" disabled>Précédent</button>
        <button class="primary" id="nextBtn" onclick="changeStep(1)" disabled>Suivant</button>
    </div>
</div>

<script>
    let currentStep = 1;
    let selectedProblem = null;
    let selectedTechnique = null;
    let step6Verified = false;
    let step8Verified = false;

    const techniquesData = {
        1: ["Animal", "Métier", "Objet", "Couleur", "Musique", "Verbe"],
        2: ["Objet", "Couleur", "Musique", "Verbe"],
        3: ["Métier", "Animal", "Verbe"],
        4: ["Objet", "Maison", "Verbe", "Couleur"],
        5: ["Technologie", "Couleur", "Maison", "Musique", "Verbe", "Sujet"],
        6: ["Sujet", "Technologie", "Paramètre", "Musique", "Objet"],
        7: ["Technologie", "Paramètre", "Musique", "Objet"],
        8: ["Couleur", "Objet", "Technologie", "Maison", "Paramètre", "Animal"],
        9: ["Animal", "Couleur", "Paramètre"]
    };

    const corrections = {
        "1-1": ["Je suis une chèvre", "qui est médecin", "avec une peluche", "de couleur rouge", "qui fait de la musique jazz", "pour rigoler"],
        "1-2": ["Je suis une peluche", "de couleur grise", "qui joue de la guitare", "en rigolant"],
        "1-3": ["Je suis un jardinier", "qui a un chien", "rigolo"],
        "2-4": ["Je suis une peluche", "dans une grande maison", "qui est sale", "et est marron"],
        "2-5": ["Je suis une télévision", "de couleur noire", "dans une petite maison", "où il y a du rock", "on ne s'ennuie pas", "chez Lisa"],
        "2-6": ["Je suis Lisa", "j'adore la télévision", "avec un grand écran", "où je peux écouter du rap", "en utilisant mon téléphone"],
        "3-7": ["Je suis un téléphone", "très petit", "on ne peut pas écouter de la musique avec moi", "car je ne suis pas une enceinte"],
        "3-8": ["Je suis rouge", "de la forme d'un ballon", "avec un écran", "je me trouve dans le salon", "je suis petit", "les chiens m'adorent"],
        "3-9": ["Je suis un chien", "de couleur rouge", "je suis très grand"]
    };

    const blockColors = { "Technologie": "#8ec5c6", "Paramètre": "#a6e27e", "Musique": "#f4a7d6", "Objet": "#fef08a", "Animal": "#fcd45c", "Métier": "#8ec5c6", "Verbe": "#f4a7d6", "Couleur": "#fef08a", "Maison": "#a6e27e", "Sujet": "#fcd45c" };
    const chatData = [ { t: "Je suis un loup", c: true }, { t: "Je suis une chèvre", c: false }, { t: "Je suis un chien", c: true }, { t: "Je suis un castor", c: true }, { t: "Je suis un mouton", c: false }, { t: "Je suis une vache", c: true }, { t: "Je suis un chat", c: false } ];
    let chatAnswers = {};

    function checkPass() {
        if(document.getElementById('pass').value === "Atprom.2026.2") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main').style.display = 'block';
            renderFrise();
        } else { alert("Mot de passe incorrect"); }
    }

    function renderFrise() {
        const colors = [ "#0a194e", "#fcd45c", "#227c7d", "#e91e9e", "#0a194e", "#a6e27e", "#fcd45c", "#227c7d" ];
        const container = document.getElementById('frise-container');
        container.innerHTML = colors.map((c, i) => `<div class="frise-step ${i === 0 ? 'active' : ''}" style="background:${c}; ${i===1||i===5||i===6 ? 'color:#333':''}">Étape ${i+1}</div>`).join('');
    }

    function selectProblem(p, el) {
        selectedProblem = p;
        document.querySelectorAll('.p-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        
        const container = document.getElementById('technique-options');
        container.innerHTML = '';
        const range = p === 1 ? [1,2,3] : p === 2 ? [4,5,6] : [7,8,9];
        range.forEach(t => {
            const div = document.createElement('div');
            div.className = 'card t-card';
            div.innerText = 'Technique ' + t;
            div.onclick = () => selectTechnique(t, div);
            container.appendChild(div);
        });
        checkValidation();
    }

    function selectTechnique(t, el) {
        selectedTechnique = t;
        document.querySelectorAll('.t-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        
        // Prepare steps 3 & 4
        const inputDiv = document.getElementById('input-blocks');
        const corrDiv = document.getElementById('correction-blocks');
        inputDiv.innerHTML = ''; corrDiv.innerHTML = '';

        techniquesData[t].forEach((b, i) => {
            inputDiv.innerHTML += `<div class="block-wrapper"><div class="block-box" style="background:${blockColors[b]}"><textarea oninput="checkValidation()" placeholder="Saisir ici..."></textarea></div><div style="font-weight:600;margin-top:5px">${b}</div></div>`;
            corrDiv.innerHTML += `<div class="block-wrapper"><div class="block-box" style="background:${blockColors[b]}">${corrections[selectedProblem+'-'+t][i]}</div><div style="font-weight:600;margin-top:5px">${b}</div></div>`;
        });
        checkValidation();
    }

    function checkValidation() {
        let valid = false;
        if(currentStep === 1) valid = selectedProblem !== null;
        else if(currentStep === 2) valid = selectedTechnique !== null;
        else if(currentStep === 3) {
            const txs = document.querySelectorAll('#input-blocks textarea');
            valid = Array.from(txs).every(t => t.value.trim().length > 2);
        }
        else if(currentStep === 4 || currentStep === 5 || currentStep === 7) valid = true;
        else if(currentStep === 6) valid = step6Verified;
        else if(currentStep === 8) valid = step8Verified;

        document.getElementById('nextBtn').disabled = !valid;
    }

    function changeStep(dir) {
        document.getElementById('step' + currentStep).classList.add('hidden');
        currentStep += dir;
        document.getElementById('step' + currentStep).classList.remove('hidden');
        
        document.getElementById('prevBtn').disabled = currentStep === 1;
        document.getElementById('nextBtn').classList.toggle('hidden', currentStep === 8);
        
        document.querySelectorAll('.frise-step').forEach((s, i) => s.classList.toggle('active', i < currentStep));
        
        if(currentStep === 6) renderChat();
        if(currentStep === 8) renderMatch();
        checkValidation();
    }

    function renderChat() {
        const container = document.getElementById('chat-quiz');
        container.innerHTML = chatData.map((m, i) => `
            <div>
                <div class="bubble" id="bubble-${i}">${m.t}</div>
                <div class="btn-check-group">
                    <button class="btn-verify" id="c${i}" onclick="setChatAns(${i}, true)">Correct</button>
                    <button class="btn-verify" id="i${i}" onclick="setChatAns(${i}, false)">Incorrect</button>
                </div>
            </div>`).join('');
    }

    function setChatAns(idx, val) {
        chatAnswers[idx] = val;
        document.getElementById('c'+idx).className = val ? 'btn-verify active-correct' : 'btn-verify';
        document.getElementById('i'+idx).className = !val ? 'btn-verify active-incorrect' : 'btn-verify';
        if(Object.keys(chatAnswers).length === 7) checkValidation();
    }

    function validateStep6() {
        let score = 0;
        chatData.forEach((m, i) => {
            const bubble = document.getElementById('bubble-'+i);
            if(chatAnswers[i] === m.c) { score++; bubble.className = 'bubble correct-glow'; }
            else { bubble.className = 'bubble wrong-glow'; }
        });
        step6Verified = true;
        document.getElementById('score6').style.display = 'block';
        document.getElementById('score6').innerText = "Score : " + score + " / 7";
        checkValidation();
    }

    function renderMatch() {
        const container = document.getElementById('final-match');
        container.innerHTML = [1,2,3].map(p => `
            <div class="card" style="text-align:left; margin-bottom:20px; cursor:default">
                <strong>Problème ${p} :</strong> Quelle(s) technique(s) ?
                <div class="checkbox-grid" id="match-grid-${p}">
                    ${[1,2,3,4,5,6,7,8,9].map(t => `
                        <label class="check-item" id="label-${p}-${t}">
                            <input type="checkbox" data-prob="${p}" data-tech="${t}" onchange="checkValidation()"> Tech ${t}
                        </label>
                    `).join('')}
                </div>
            </div>`).join('');
    }

    function validateStep8() {
        let score = 0;
        [1,2,3].forEach(p => {
            let pCorrect = true;
            const validRange = p === 1 ? [1,2,3] : p === 2 ? [4,5,6] : [7,8,9];
            
            [1,2,3,4,5,6,7,8,9].forEach(t => {
                const cb = document.querySelector(`input[data-prob="${p}"][data-tech="${t}"]`);
                const label = document.getElementById(`label-${p}-${t}`);
                const isTechniqueValidForProb = validRange.includes(t);
                
                if(cb.checked) {
                    if(isTechniqueValidForProb) label.classList.add('correct-match');
                    else { label.classList.add('wrong-match'); pCorrect = false; }
                } else {
                    if(isTechniqueValidForProb) { label.style.border = "2px dashed var(--red)"; pCorrect = false; }
                }
            });
            if(pCorrect) score++;
        });
        step8Verified = true;
        document.getElementById('score8').style.display = 'block';
        document.getElementById('score8').innerText = "Problèmes maîtrisés : " + score + " / 3";
        checkValidation();
    }
</script>
</body>
</html>
